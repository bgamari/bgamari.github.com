<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>bgamari.github.com - Cross-compiling a kernel for the Odroid XU4 on Debian</title>
    <link rel="stylesheet" type="text/css" href="../css/default.css" />
    <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  </head>
  <body>
    <div id="container">
      <div id="content">
        <div id="sidebar">
          <nav>
            <h1>Navigation</h1>
            <ul>
              <li><a href="../index.html">Home</a></li>
              <li><a href="../posts.html">Blog</a></li>
              <li><a href="../research-agenda.html">Research agenda</a></li>
              <li><a href="../publications.html">Publications</a></li>
              <li><a href="../past-research.html">Past research</a></li>
              <li><a href="../media/cv.pdf">Curriculum Vitæ</a></li>
            </ul>
            <h1>Related Links</h1>
            <ul>
              <li><a href="http://goldnerlab.physics.umass.edu/wiki/">Research group</a></li>
              <li><a href="http://www.github.com/bgamari">Github</a></li>
            </ul>
          </nav>
        </div>

        <section id="main">
        <article>
    <h1>Cross-compiling a kernel for the Odroid XU4 on Debian</h1>
    <header>
        <div class="meta">
            <time datetime="2015-11-30" class="pubdate">2015-11-30</time> | tagged with <ul class="tags"><li>kernel</li><li>arm</li><li>debian</li><li>notes</li><li>work-in-progress</li></ul>
        </div>
    </header>

    <p>These are notes from my trying experience bringing up a recent kernel on an Odroid XU4 running Debian Wheezy.</p>
<p>You’ll need a compiler toolchain on the build machine,</p>
<pre><code>sudo apt-get install build-essential kernel-package u-boot-tools</code></pre>
<p>Grab the configuration from <a href="../media/linux-4.4-rc2.odroidxu4.config">here</a> and place it in the kernel tree as <code>.config</code>. Now build the kernel,</p>
<pre><code>export ARCH=arm
export DEB_HOST_ARCH=armhf
export CONCURRENCY_LEVEL=6
fakeroot make-kpkg --arch=arm --cross-compile arm-linux-gnueabihf- --initrd kernel_image kernel_headers</code></pre>
<p>Now copy the resulting <code>.deb</code> to the target and install it,</p>
<pre><code>$ scp ben-server.local:linux-image-4.4.0-rc2... .
$ scp ben-server.local:linux-2.6/arch/arm/boot/dts/exynos5422-odroidxu4.dtb .
$ sudo mv exynos5422-odroidxu4.dtb /boot/exynos5422-odroidxu4-4.4.0-rc2+.dtb
$ sudo dpkg -i linux-image-4.4.0-rc2+_4.4.0-rc2+-10.00.Custom_armhf.deb</code></pre>
<p>Unfortunately the post-install hooks included in Odroid’s Debian distribution are a bit of a disaster. Ultimately I found it necessary to hack <code>/etc/kernel/postinst.d/odroid-boothelper</code>, replacing the <code>cp</code> lines responsible for moving the kernel image to <code>/boot</code> (which isn’t necessary with <code>kernel-package</code>-generated packages) with,</p>
<pre><code>if [ ! -f /boot/${zimage} ]; then
    cp -f /lib/modules/${version}/boot/${zimage} /boot
elif [ ! -d /lib/modules/${version} -o ! -f /lib/modules/${version}/boot/${zimage} ]; then
    cp -f /boot/${zimage} /lib/modules/${version}/boot
fi
if [ ! -f /boot/${fdtbin} ]; then
    cp -f /lib/modules/${version}/boot/${fdtbin} /boot
fi</code></pre>
<p>Sadly even this wasn’t enough and my patience was running thin. I just ran the script without <code>bash -e</code> to ensure it ran to completion,</p>
<pre><code>bash -x /etc/kernel/postinst.d/odroid-boothelper 4.4.0-rc2+ /boot/vmlinuz-4.4.0-rc2+</code></pre>
<p>Rebooting, I had a new kernel.</p>
</article>

        </section>
      </div>

      <footer id="footer">
        <span>Generated by <a href="http://jaspervdj.be/hakyll/index.html">Hakyll</a>.</span>
      </footer>
    </div>
  </body>
</html>

