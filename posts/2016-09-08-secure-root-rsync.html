<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>bgamari.github.com - Securely copying with escalated privileges with rsync</title>
    <link rel="stylesheet" type="text/css" href="../css/default.css" />
    <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  </head>
  <body>
    <div id="container">
      <div id="content">
        <div id="sidebar">
          <nav>
            <h1>Navigation</h1>
            <ul>
              <li><a href="../index.html">Home</a></li>
              <li><a href="../posts.html">Blog</a></li>
              <li><a href="../research-agenda.html">Research agenda</a></li>
              <li><a href="../publications.html">Publications</a></li>
              <li><a href="../past-research.html">Past research</a></li>
              <li><a href="../media/cv.pdf">Curriculum Vitæ</a></li>
            </ul>
            <h1>Related Links</h1>
            <ul>
              <li><a href="http://goldnerlab.physics.umass.edu/wiki/">Research group</a></li>
              <li><a href="http://www.github.com/bgamari">Github</a></li>
            </ul>
          </nav>
        </div>

        <section id="main">
        <article>
    <h1>Securely copying with escalated privileges with rsync</h1>
    <header>
        <div class="meta">
            <time datetime="2016-09-08" class="pubdate">2016-09-08</time> | tagged with <ul class="tags"><li>rsync</li><li>sudo</li><li>ssh</li></ul>
        </div>
    </header>

    <p>Recently I had to migrate some files from one machine to another. As usual, <code>rsync</code> was the first tool I reached for, but a few considerations complicated matters: 1. both the source and destination locations required escalated privileges to access 2. remote <code>root</code> logins were not allowed on either machine, ruling out <code>sudo     rsync $path root@$dest</code> 3. passwordless <code>sudo</code> was not allowed on either machine, ruling out <code>sudo     rsync --rsync-path='sudo rsync'</code>.</p>
<p>Consequently, the solution here is to use <code>rsync</code>’s daemon mode. However, it’s obviously undesireable to start a privileged <code>rsync</code> daemon on the open internet. For this reason, we run the <code>rsync</code> daemon over an <code>ssh</code> tunnel. Here is how,</p>
<ol type="1">
<li>on the destination: <code>ssh -L 9000:127.0.0.1:9000 \$src_host</code></li>
<li>on the source: create an <code>rsyncd.conf</code>,</li>
</ol>
<pre><code>$ cat &gt;rsyncd.conf &lt;&lt;EOF
use chroot = false
port = 9000
[src]
path = $src_path
uid = $user
gid = $group
EOF</code></pre>
<ol start="3" type="1">
<li>on the source: <code>sudo rsync --daemon --config=rsyncd.conf --no-detach</code></li>
<li>on the destination: <code>sudo rsync -a --info=progress2 rsync://127.0.0.1:9000:\$src_path \$dest_path</code></li>
</ol>
</article>

        </section>
      </div>

      <footer id="footer">
        <span>Generated by <a href="http://jaspervdj.be/hakyll/index.html">Hakyll</a>.</span>
      </footer>
    </div>
  </body>
</html>

